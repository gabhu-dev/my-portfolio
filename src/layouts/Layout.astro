---
import "../styles/global.css";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro Basics</title>

    <!-- Initialize theme before page renders to prevent flash -->
    <script is:inline>
      function getInitialTheme() {
        // 1. Check if user has a saved preference
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) return savedTheme;

        // 2. Fall back to system preference
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      // Apply theme immediately
      document.documentElement.setAttribute("data-theme", getInitialTheme());
    </script>
  </head>
  <body>
    <div id="tsparticles"></div>
    <slot />
    <script>
      import { tsParticles } from "@tsparticles/engine";
      import { loadSlim } from "@tsparticles/slim";

      async function initParticles() {
        await loadSlim(tsParticles);
        await tsParticles.load({
          id: "tsparticles",
          options: {
            background: {
              color: {
                value: "transparent",
              },
            },
            fpsLimit: 120,
            interactivity: {
              events: {
                onClick: {
                  enable: true,
                  mode: "push",
                },
                onHover: {
                  enable: true,
                  mode: "repulse",
                },
              },
              modes: {
                push: {
                  quantity: 4,
                },
                repulse: {
                  distance: 200,
                  duration: 0.4,
                },
              },
            },
            particles: {
              color: {
                value: ["#818cf8", "#c084fc", "#fb7185"],
              },
              move: {
                direction: "none",
                enable: true,
                outModes: {
                  default: "bounce",
                },
                random: false,
                speed: 1,
                straight: false,
              },
              number: {
                density: {
                  enable: true,
                },
                value: 10,
                limit: {
                  value: 20,
                },
              },
              opacity: {
                value: 0.5,
              },
              shape: {
                type: "circle",
              },
              size: {
                value: { min: 2, max: 5 },
              },
            },
            detectRetina: true,
          },
        });
      }

      initParticles();

      // IntersectionObserver to remove #contact hash when scrolling away
      const observerOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.1,
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting && window.location.hash === "#contact") {
            history.replaceState(
              null,
              "",
              window.location.pathname + window.location.search,
            );
          }
        });
      }, observerOptions);

      const contactSection = document.getElementById("contact");
      if (contactSection) {
        observer.observe(contactSection);
      }
    </script>
  </body>
</html>

<style is:global>
  @reference "tailwindcss";
  @custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));

  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
    color: #000;
    scroll-behavior: smooth;
    @apply dark:text-white dark:bg-gray-800;
  }

  #tsparticles {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 10;
    pointer-events: none;
  }

  a {
    @apply cursor-pointer hover:text-indigo-600;
  }
</style>
