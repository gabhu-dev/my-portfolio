---
import MNavItem from "./MNavItem.astro";
import { MoonIcon, SunIcon } from "@lucide/astro";
import Avatar from "../assets/images/avatar.jpg";
---

<nav>
  {
    Astro.url.pathname !== "/" && (
      <div class="avatar">
        <img src={Avatar.src} alt="Gabhu" class="avatar__img" />
        <p>Gabhu-dev</p>
      </div>
    )
  }
  <div style="flex:1"></div>
  <button id="theme-toggle" aria-label="Cambiar tema">
    <MoonIcon id="moon-icon" class="size-5" />
    <SunIcon id="sun-icon" class="size-5 hidden" />
  </button>

  <MNavItem href="/"> Sobre mí </MNavItem>
  <MNavItem href="#projects"> Mis trabajos </MNavItem>
  <MNavItem href="#contact"> Contáctame </MNavItem>
</nav>

<script>
  // Update icon visibility based on current theme
  function updateThemeIcons() {
    const theme = document.documentElement.getAttribute("data-theme");
    const moonIcon = document.getElementById("moon-icon");
    const sunIcon = document.getElementById("sun-icon");

    if (theme === "dark") {
      // In dark mode, show sun icon (to switch to light)
      moonIcon?.classList.add("hidden");
      sunIcon?.classList.remove("hidden");
    } else {
      // In light mode, show moon icon (to switch to dark)
      moonIcon?.classList.remove("hidden");
      sunIcon?.classList.add("hidden");
    }
  }

  // Toggle between light and dark themes
  function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute("data-theme");
    const newTheme = currentTheme === "dark" ? "light" : "dark";

    // Update data-theme attribute
    document.documentElement.setAttribute("data-theme", newTheme);

    // Save to localStorage
    localStorage.setItem("theme", newTheme);

    // Update icons
    updateThemeIcons();
  }

  // Initialize icons on page load
  updateThemeIcons();

  // Listen for clicks on theme toggle button
  document
    .getElementById("theme-toggle")
    ?.addEventListener("click", toggleTheme);

  // Optional: Listen for system preference changes
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      // Only apply if user hasn't manually set a preference
      if (!localStorage.getItem("theme")) {
        const newTheme = e.matches ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", newTheme);
        updateThemeIcons();
      }
    });
</script>

<style>
  @reference "tailwindcss";
  @custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));

  nav {
    @apply flex justify-end gap-5 py-8 px-24 items-center;
  }

  #theme-toggle {
    @apply cursor-pointer transition-transform hover:text-indigo-500 hover:scale-110 bg-transparent border-0 p-0;
  }

  .avatar {
    @apply flex items-center gap-2;
  }

  .avatar__img {
    @apply w-10 h-10 rounded-full object-cover;
  }

  .avatar p {
    @apply text-gray-900 font-semibold dark:text-white;
  }
</style>
